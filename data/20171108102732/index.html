<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">


<meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" media="handheld" href="http://chenpiaoping.blog.51cto.com/#">


<title>trafficserver的DNS初始化源码分析一 - 陈漂评的博客 - 51CTO技术博客</title>
<meta name="description" content="SplitDNS功能：SplitDNS可以配置ats使用多个DNS服务器，这样是处于安全考虑的。配置：（1）开启splitdns，即proxy.config.dns.splitDNS.enabled的值设置为1（2）在splitdns.config里添加规则，这些规则可以实现那..">
<meta name="keywords" content="traffic server dns 源码分析">
<meta http-equiv="Cache-Control" content="private">







<link rel="alternate" href="http://chenpiaoping.blog.51cto.com/rss.php?uid=5631143" type="application/rss+xml" title="RSS 2.0">
<link rel="edituri" type="application/rsd+xml" title="rsd" href="http://chenpiaoping.blog.51cto.com/xmlrpc.php?rsd=1">





<link rel="stylesheet" type="text/css" id="SL_Style" href="chrome://imtranslator/content/css/translator.css">
<link media="all" href="index.css" type="text/css" rel="stylesheet">
</head>
<body>

<div id="home_top">
<div class="top_nav" style="width: 990px;">
<div class="left" style="margin-top: 10px; width: 600px;"><a href="http://blog.51cto.com/" target="_top"><img src="head_blog_sibebar_logo.gif" style="margin-top: -4px;" align="absmiddle"></a><!--<a target="_blank" href="http://www.51cto.com">51CTO首页</a>--><img src="top_bg_xian.gif" style="margin-top: -4px;" width="16" align="absmiddle" height="25"><a href="http://blog.51cto.com/" target="_top">首页</a><img src="top_bg_xian.gif" style="margin-top: -4px;" width="16" align="absmiddle" height="25"><a href="http://home.51cto.com/?reback=http%253A%252F%252Fchenpiaoping.blog.51cto.com%252F5631143%252F1364486">我的博客</a><img src="top_bg_xian.gif" style="margin-top: -4px;" width="16" align="absmiddle" height="25">


   <a href="http://blog.51cto.com/artcommend">推荐博文</a>
    <img src="top_bg_xian.gif" style="margin-top: -4px;" width="16" align="absmiddle" height="25"><a href="http://blog.51cto.com/original/">最新原创</a>
    <img src="top_bg_xian.gif" style="margin-top: -4px;" width="16" align="absmiddle" height="25"><a href="http://blog.51cto.com/expert">专家博客</a>
    <img src="top_bg_xian.gif" style="margin-top: -4px;" width="16" align="absmiddle" height="25"><a href="http://blog.51cto.com/blogcommend">推荐博客</a>
    <img src="top_bg_xian.gif" style="margin-top: -4px;" width="16" align="absmiddle" height="25"><a target="_top" href="http://so.51cto.com/">搜索</a>
    <!--<a href="javascript:void(0);" style="color:#FF0000; text-decoration:underline; display:none" id="showMessagerDim">每日博报</a>-->
</div>

<div class="right" style="width: 380px;">
<div class="more"><img src="top_shequ.gif" width="27" align="absmiddle" height="16"><a href="javascript:viod(0);">网站导航<img style="padding-left: 4px;" src="nav_ico1.gif" align="absmiddle"></a>            </div>            <span id="login_status"><div class="login" style="padding-top: 8px; text-align: right;"><a href="http://home.51cto.com/index?reback=http://chenpiaoping.blog.51cto.com/5631143/1364486" target="_self">登录</a><a href="http://home.51cto.com/user/register?reback=http://chenpiaoping.blog.51cto.com/5631143/1364486" target="_self">注册</a><a href="http://home.51cto.com/members/in-fo?down" target="_top"><span class="jsVipDrop" style="position: relative;"><img src="vip_grey2.png" style="float: right; margin-top: 5px;"><div id="vip_mes_top" style="display: none; position: absolute; right: -75px; top: 17px; width: 137px; z-index: 99;"><div style="background: rgb(250, 247, 230) none repeat scroll 0px 0px; border: 1px solid rgb(236, 183, 165); color: rgb(102, 102, 102); font-size: 12px; padding: 3px 5px; position: relative;"><span style="background: rgba(0, 0, 0, 0) url('hidearro.png') no-repeat scroll center center; display: inline-block; height: 7px; position: absolute; right: 57px; top: -6px; width: 12px;"></span><div style="color: rgb(255, 102, 0); text-align: center;">一个会员，全站特权</div></div></div></span></a></div></span>                </div>    </div></div>



<div class="subMenu3" id="s3">
<ul>

<li><a href="http://edu.51cto.com/" target="_top">学院</a></li>
<li><a href="http://blog.51cto.com/" target="_top">博客</a></li>
<li><a href="http://bbs.51cto.com/" target="_top">论坛</a></li>
<li><a href="http://down.51cto.com/" target="_top">下载</a></li>
    <li><a href="http://home.51cto.com/" target="_top">家园</a></li>
<li><a href="http://wot.51cto.com/?blog" target="_top">WOT峰会</a></li>
    <li><a href="http://www.51cto.com/" target="_top">51CTO主站</a></li>
</ul>
</div>
<!--简导航end-->



<div class="headerBox">
<div class="header">
<div class="header_l">
<div class="logo_blogname">



<div class="blogName">
<a href="http://chenpiaoping.blog.51cto.com/"><h1>陈漂评的博客</h1></a>
</div>
</div><!--logo_blogname end-->
<div class="blogLink">

<a href="http://chenpiaoping.blog.51cto.com/">http://chenpiaoping.blog.51cto.com</a> <input id="txtUser" size="32" value="http://chenpiaoping.blog.51cto.com" type="hidden">   <a href="javascript:void(0);" onclick="copy();">【复制】</a> <a href="http://chenpiaoping.blog.51cto.com/rss.php?uid=5631143" target="_top"></a><a href="http://chenpiaoping.blog.51cto.com/rss.php?uid=5631143" target="_top">【订阅】</a>

</div>



</div><!--header_l end-->
<div class="header_r">
<div class="blogInfo"><span><a href="http://chenpiaoping.blog.51cto.com/5631143/o" title="察看chenpingpiao所有原创文章">原创</a>:55</span><span><a href="http://chenpiaoping.blog.51cto.com/5631143/t" title="察看chenpingpiao所有翻译文章">翻译</a>:0</span><span><a href="http://chenpiaoping.blog.51cto.com/5631143/c" title="察看chenpingpiao所有转载文章">转载</a>:54</span></div>

</div>
</div>
<!--header end-->
</div><!--headerBox end-->
<div class="mainNav">
<span class="mainNavT"></span>
<ul>
<li><a href="http://chenpiaoping.blog.51cto.com/">主页</a></li>|<li><a href="http://chenpiaoping.blog.51cto.com/5631143/d-1">虚拟网络</a></li>|<li><a href="http://chenpiaoping.blog.51cto.com/5631143/d-2">linux</a></li>|<li><a href="http://chenpiaoping.blog.51cto.com/5631143/d-3">云计算</a></li>|<li><a href="http://chenpiaoping.blog.51cto.com/5631143/d-4">网络技术</a></li>|<li><a href="http://chenpiaoping.blog.51cto.com/5631143/d-5">ruby</a></li>|<li><a href="http://chenpiaoping.blog.51cto.com/5631143/d-6">opennebula</a></li>|<li><a href="http://chenpiaoping.blog.51cto.com/5631143/d-7">其他</a></li>|<li><a href="http://chenpiaoping.blog.51cto.com/5631143/d-8">traffic server</a></li>|<li><a href="http://chenpiaoping.blog.51cto.com/5631143/d-9">dpdk</a></li>|<li><a href="http://chenpiaoping.blog.51cto.com/5631143/d-10">vpp</a></li>
</ul>
<span class="mainNavB"></span>
</div>
<!--mainNav end-->




<!--[if IE 6]>
  <script type="text/javascript" src="http://images.watchstor.com/newhomes/png.js"></script>
  <script>
    DD_belatedPNG.fix('img,input,ul,li, .get-box, div, .add, .sub, .ui-slider-handle, .footer-chopper');
  </script>
<![endif]-->


















<div id="add_sys_type_div" style="width: 600px; border: 1px solid rgb(88, 176, 221); background-color: rgb(255, 255, 255); position: absolute; left: 30%; top: 300px; display: none; z-index: 255;"></div>
<div id="add_sys_type_dvs" style="width: 550px; border: 1px solid rgb(88, 176, 221); background-color: rgb(255, 255, 255); position: absolute; left: 30%; top: 300px; display: none; z-index: 255;"></div>




<div class="blogMain">
<div class="blogLeft">


<div class="box moduleUser">
<div class="title">
<h2><a href="http://chenpiaoping.blog.51cto.com/"><strong>chenpingpiao</strong> 的BLOG  </a></h2>
</div>
<div class="modCon">

<div class="userImage" style="margin: 10px auto 5px; text-align: center; width: 130px; border: 1px solid rgb(212, 212, 212);">
	<table width="100%" cellspacing="0" cellpadding="0">
		<tbody><tr>
			<td class="position_r" valign="middle" align="center" height="130"><a href="http://chenpiaoping.blog.51cto.com/"><img src="avatar.php" id="userface"></a></td>
		</tr>
	</tbody></table>
</div>
<div class="photo_links">
</div>









    <div class="newcrumbox">
        <div class="a_lsits">
            <a href="http://home.51cto.com/index.php?s=/Notify/write/uid/5631143" class="newicon_3 newicon_d">发私信</a>
            <a href="http://chenpiaoping.blog.51cto.com/" onclick="add_flink(5631143);return false" class="newicon_5 newicon_l">加友情链接</a>
        </div>
    </div>

<div style="width: 239px; height: 64px; display: none;">


<div style="float: left;"><p style="padding: 15px 0px 0px 28px; line-height: 20px;">2012年度IT博客大赛<br><a target="_top" href="http://blog.51cto.com/contest2012/#top10000" style="color: rgb(255, 0, 0); text-decoration: underline;">十大杰出IT博客诞生</a></p></div>
<div style="float: right;"><a target="_top" href="http://blog.51cto.com/contest2012/"><img src="blog_match_endlook.jpg" style="margin: 23px 20px 0px 0px;" width="57" height="27"></a></div>
<!-- <div style="float:left;"><p style="padding:15px 0 0 28px; line-height:20px;">星光评委正在评选<br><a target="_blank" href="http://blog.51cto.com/contest2012/index.php?mod=userlist_sec" style="color:#F00; text-decoration:underline;">2012年度IT博客大赛50强</a></p></div>
<div style="float:right;"><img class="blog_match_yq" width="57" height="27" src="http://img1.51cto.com/images/blog_match_invite.jpg" style="margin:23px 20px 0 0;"></div> -->



<div class="clear"></div>
</div>


</div><!--modCon end-->
<span class="modBot"></span>
</div>


<div class="infoList box">
<div class="title">
<h2>博客统计信息</h2>
</div>
<div class="modCon">
<p>
<span class="infoListHead"></span>
用户名：chenpingpiao<br>
文章数：133<br>
评论数：1<br>
访问量：49341<br>
<a href="http://home.51cto.com/index.php?s=/Account/credit" target="_top">无忧币</a>：1252<br>
<a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_top">博客积分</a>：780<br>
<a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_top">博客等级</a>：4<br>
注册日期：2012-07-31<br>
</p>
</div>
<span class="modBot"></span>
</div>


<div class="infoList box">
	<div class="title">
		<h2 class="fl">热门专题</h2>
		<a target="_top" class="fr" href="http://blog.51cto.com/zt">更多&gt;&gt;</a>
	</div>
	<div class="modCon" style="height: 348px;">


		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/705" target="_top"><img src="wkiol1kxbvqdxivdaaa4f7mg1so675.jpg" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/705" target="_top" title="Oracle零基础成长之路">Oracle零基础成长之路</a></dt>
		<dd>阅读量：1297</dd>
		</dl>
		</div>

		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/706" target="_top"><img src="wkiol1k_spejgppuaaa3gnotfpu742.png" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/706" target="_top" title="原来你也在这里（征文）">原来你也在这里（征文）</a></dt>
		<dd>阅读量：3317</dd>
		</dl>
		</div>

		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/711" target="_top"><img src="wkiol1mtbyyrq8w_aaats74x_ao914.jpg" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/711" target="_top" title="PHPWAMP官方使用文档">PHPWAMP官方使用文档</a></dt>
		<dd>阅读量：585481</dd>
		</dl>
		</div>

		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/14" target="_top"><img src="1304672337_index.jpg" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/14" target="_top" title="从菜鸟到老鸟-教你玩转Mac操作系统">从菜鸟到老鸟-教你玩转Mac操作系统</a></dt>
		<dd>阅读量：471279</dd>
		</dl>
		</div>


	</div>
	<span class="modBot"></span>
</div>


<div class="hotArt box">
<div class="title">
<h2>热门文章</h2>
</div>
<div class="modCon">
<ul>
<li><a href="http://chenpiaoping.blog.51cto.com/5631143/1086707">VXLAN技术学习笔记</a></li>
<li><a href="http://chenpiaoping.blog.51cto.com/5631143/1329919">selinux 的设置导致vsftp..</a></li>
<li><a href="http://chenpiaoping.blog.51cto.com/5631143/1253912">opendaylight的安装</a></li>
<li><a href="http://chenpiaoping.blog.51cto.com/5631143/1339943">trafficserver records.c..</a></li>
<li><a href="http://chenpiaoping.blog.51cto.com/5631143/1253918">在eclipse中搭建opendayl..</a></li>
<li><a href="http://chenpiaoping.blog.51cto.com/5631143/1389765">python socket recv方法</a></li>
<li><a href="http://chenpiaoping.blog.51cto.com/5631143/1148426">openvswitch源码阅读笔记..</a></li>
<li><a href="http://chenpiaoping.blog.51cto.com/5631143/1141728">openvswitch架构图</a></li>

</ul>
</div>
<span class="modBot"></span>
</div>
<div class="search box">
<div class="title"><h2>搜索BLOG文章</h2></div>
<div class="modCon">
<form method="post" action="http://chenpiaoping.blog.51cto.com/search.php?" tabindex="99">
<input name="step" value="2" type="hidden">
<input name="authorid" value="5631143" type="hidden">
<input name="sch_area" value="S" type="hidden">
<input value="" name="keyword" class="searchInput" type="text">
<input value="搜 索" class="searchBtn" type="submit">
</form>
</div><!--modCon end-->
<span class="modBot"></span>
</div>


<div class="box recentGuests">
<div class="title">
<h2>最近访客</h2>
</div>
<div class="modCon">
<ul>

<li><a href="http://5608507.blog.51cto.com/" class="position_r"><img src="avatar_001.php"></a>


<p><a href="http://5608507.blog.51cto.com/">hanks..</a></p>

</li><li><a href="http://6332573.blog.51cto.com/" class="position_r"><img src="avatar_002.php"></a>


<p><a href="http://6332573.blog.51cto.com/">gxw25..</a></p>

</li><li><a href="http://12787955.blog.51cto.com/" class="position_r"><img src="avatar_003.php"></a>


<p><a href="http://12787955.blog.51cto.com/">wb58e..</a></p>

</li><li><a href="http://2878940.blog.51cto.com/" class="position_r"><img src="avatar_004.php"></a>


<p><a href="http://2878940.blog.51cto.com/">kfeiwu</a></p>

</li><li><a href="http://12904076.blog.51cto.com/" class="position_r"><img src="avatar_005.php"></a>


<p><a href="http://12904076.blog.51cto.com/">zhoup..</a></p>

</li><li><a href="http://12842282.blog.51cto.com/" class="position_r"><img src="avatar_006.php"></a>


<p><a href="http://12842282.blog.51cto.com/">Nidho..</a></p>

</li><li><a href="http://2130923.blog.51cto.com/" class="position_r"><img src="avatar_007.php"></a>


<p><a href="http://2130923.blog.51cto.com/">dashion1</a></p>

</li><li><a href="http://squawell.blog.51cto.com/" class="position_r"><img src="avatar_008.php"></a>


<p><a href="http://squawell.blog.51cto.com/">buja</a></p>

</li><li><a href="http://13396604.blog.51cto.com/" class="position_r"><img src="avatar_009.php"></a>


<p><a href="http://13396604.blog.51cto.com/">wb59d..</a></p>

</li><li><a href="http://1458573.blog.51cto.com/" class="position_r"><img src="avatar_010.php"></a>


<p><a href="http://1458573.blog.51cto.com/">jhualin</a></p>

</li><li><a href="http://wbyyy.blog.51cto.com/" class="position_r"><img src="avatar_011.php"></a>


<p><a href="http://wbyyy.blog.51cto.com/">wb_ra..</a></p>

</li><li><a href="http://11711923.blog.51cto.com/" class="position_r"><img src="avatar_012.php"></a>


<p><a href="http://11711923.blog.51cto.com/">厉害..</a></p>

</li></ul>
<span class="clear"></span>
</div>
<span class="modBot"></span>
</div>


<div class="newComments box">
<div class="title">
<h2>最新评论

</h2>



</div>
<div class="modCon">
<ul>

<li><a href="http://hongfenmo.blog.51cto.com/" class="operlink" target="_top"><b>hongfenmo</b></a>：<a href="http://chenpiaoping.blog.51cto.com/5631143/1253918" target="_top">博主，你好，最近我也在学习openday..</a></li>


</ul>
</div>
<span class="modBot"></span>
</div>


<div class="hotBlogArt box">
<div class="title">
  <h2 class="fl">51CTO推荐博文</h2>
  <a href="http://blog.51cto.com/artcommend" class="fr">更多&gt;&gt;</a></div>
<div class="modCon">
<ul>
<li><a href="http://gingerbeer.blog.51cto.com/625855/1976737" title="TCP-MSS, PMTU 详解- MTU工具解析与常见问题汇总-下篇" target="_top">TCP-MSS, PMTU 详解- MTU工具解析..</a></li>
<li><a href="http://simeon.blog.51cto.com/18680/1975430" title="OpenFire后台插件上传获取webshell及免密码登录linux服务器" target="_top">OpenFire后台插件上传获取webshel..</a></li>
<li><a href="http://loveunicom.blog.51cto.com/121558/1975095" title="写给年轻的你们" target="_top">写给年轻的你们</a></li>
<li><a href="http://gingerbeer.blog.51cto.com/625855/1970602" title="踢走绊脚石，MTU解析与常见问题汇总-上篇" target="_top">踢走绊脚石，MTU解析与常见问题汇..</a></li>
<li><a href="http://beanxyz.blog.51cto.com/5570417/1967122" title="一个简单的主机管理模拟程序" target="_top">一个简单的主机管理模拟程序</a></li>
<li><a href="http://gingerbeer.blog.51cto.com/625855/1967718" title="思路很重要！不同厂商Spanning-tree对接案例思考" target="_top">思路很重要！不同厂商Spanning-tr..</a></li>
<li><a href="http://gingerbeer.blog.51cto.com/625855/1965480" title="回车恐惧症？13个 JUNOS 技巧助你轻松无忧配置网络" target="_top">回车恐惧症？13个 JUNOS 技巧助你..</a></li>
<li><a href="http://chenxinjie.blog.51cto.com/7749507/1965198" title="[冇眼睇]揭秘地下'se'情'诱'导网站，上车吧！" target="_top">[冇眼睇]揭秘地下'se'情&amp;..</a></li>
<li><a href="http://itrustdata.blog.51cto.com/13246181/1961018" title="数据驱动到底是什么？如何驱动，又能驱动什么？" target="_top">数据驱动到底是什么？如何驱动，..</a></li>
<li><a href="http://chenxinjie.blog.51cto.com/7749507/1961255" title="图解ARP协议（四）代理ARP原理与实践（“善意的欺骗”）" target="_top">图解ARP协议（四）代理ARP原理与..</a></li>
<li><a href="http://chenxinjie.blog.51cto.com/7749507/1960336" title="图解ARP协议（三）ARP防御篇-如何揪出“内鬼”并“优雅的还手”？" target="_top">图解ARP协议（三）ARP防御篇-如何..</a></li>

</ul>
</div><!--modCon end-->
<span class="modBot"></span>
</div>


<div class="friendLink box">
<div class="title">
  <h2>友情链接</h2>
</div>
<div class="modCon">
<ul>

<li><a href="http://blog.51cto.com/zt" title="51CTO博客专题" target="_top">51CTO博客专题</a></li>

<li><a href="http://blog.51cto.com/artcommend" title="51CTO推荐博文" target="_top">51CTO推荐博文</a></li>

<li><a href="http://blog.51cto.com/blogcommend" title="51CTO推荐博客" target="_top">51CTO推荐博客</a></li>

<li><a href="http://blog.51cto.com/blogcommend" title="51CTO博客之星" target="_top">51CTO博客之星</a></li>

<li><a href="http://blog.51cto.com/expert" title="51CTO专家博客" target="_top">51CTO专家博客</a></li>

<li><a href="http://blog.51cto.com/" title="51CTO技术博客" target="_top">51CTO技术博客</a></li>

<li><a href="http://blog.51cto.com/" title="51CTO技术博客" target="_top">51CTO技术博客</a></li>

<li><a href="http://blog.51cto.com/" title="51CTO博客" target="_top">51CTO博客</a></li>

<li><a href="http://51ctoblog.blog.51cto.com/" title="51CTO博客开发" target="_top">51CTO博客开发</a> <img src="tubiao2.gif" alt="三日内更新"></li>

</ul>
</div><!--modCon end-->
<span class="modBot"></span>
</div>



</div>
<!--left end-->





<div class="blogRight" rel="5631143######traffic server dns 源码分析" id="article_edu_void">
<input value="12" id="edu_jia" type="hidden">

	<!--<p style="clear:both;"  class="edu_insert"></p>-->
	<!--modCon end-->
	<div class="artShow box" style="margin-top: 5px;">
   	  <div class="share" id="share">

    <div class="shareItem">
		<div class="m_sharelinks"><a target="_top" href="http://chenpiaoping.blog.51cto.com/" style="color: red;"></a><a target="_top" href="http://chenpiaoping.blog.51cto.com/" style="color: blue;"></a><a target="_top" href="http://chenpiaoping.blog.51cto.com/" style="color: blue;"></a></div>
		<p class="shareMored"><a href="http://chenpiaoping.blog.51cto.com/all/5631143">博主的更多文章&gt;&gt;</a></p>
	</div>
      </div>
       <div class="modCon">
   	  <div class="showBox" style="margin: 0px 0px 10px;">
      <div class="line_hd_r"></div>
      <div class="art_tj">

      </div>


    		<div class="showHead">
    		  <div class="showTitleBOx" style="text-align: center;">
              <div class="showTitle">

             <img src="arttype01.jpg">


    		    trafficserver的DNS初始化源码分析一
                </div>
  		    </div>
   		    <span class="artTime">2014-02-27 16:54:43</span></div><!--showHead end-->
    <div class="showTags">标签：<a href="http://blog.51cto.com/tag-traffic%20server%20dns%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html" target="_top" class="operlink">traffic server dns 源码分析</a>

	</div>

			<div class="CopyrightStatement lh22">
            原创作品，允许转载，转载时请务必以超链接形式标明文章 <a href="http://chenpiaoping.blog.51cto.com/5631143/1364486" target="_top" style="text-decoration: underline;">原始出处</a> 、作者信息和本声明。否则将追究法律责任。<a href="http://chenpiaoping.blog.51cto.com/5631143/1364486">http://chenpiaoping.blog.51cto.com/5631143/1364486</a>
            </div>


            <!--正文 begin-->


		  <div class="showContent">
    		  <span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><strong>SplitDNS</strong></span><p style="font-weight: normal; text-decoration: none; text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;"><strong><span style="font-weight: normal;">功能：</span></strong></span><span style="font-family: monospace; font-size: 12px;"><strong><span style="font-weight: normal;">SplitDNS</span></strong></span><span style="font-family: monospace; font-size: 12px;"><strong><span style="font-weight: normal;">可以配置</span></strong></span><span style="font-family: monospace; font-size: 12px;"><strong><span style="font-weight: normal;">ats</span></strong></span><span style="font-family: monospace; font-size: 12px;"><strong><span style="font-weight: normal;">使用多个</span></strong></span><span style="font-family: monospace; font-size: 12px;"><strong><span style="font-weight: normal;">DNS</span></strong></span><span style="font-family: monospace; font-size: 12px;"><strong><span style="font-weight: normal;">服务器，这样是处于安全考虑的。</span></strong></span></span></p><p style="text-align: left; margin-bottom: 0cm;">配置：</p><p style="text-align: left; margin-bottom: 0cm;">（<span style="font-family: &quot;liberation serif&quot;,serif;">1</span>）开启<span style="font-family: &quot;liberation serif&quot;,serif;">splitdns</span>，即<span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><a><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.dns.splitDNS.enabled</span></span></span></a></tt></span><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">的值设置为</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">1</span></span></span></span></strong></p><p style="text-align: left; margin-bottom: 0cm;"><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">（</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">2</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">）在</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">splitdns.config</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">里添加规则，这些规则可以实现那些请求使用哪个</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">DNS</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">服务器</span></span></strong></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><strong><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><strong>records.config</strong></span></span></strong></span><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><strong>中</strong></span><span style="font-family: monospace; font-size: 12px;"><strong>DNS</strong></span></span></span></strong><strong><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><strong>相关的配置说明</strong></span></strong></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.dns.search_default_domains</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">当开启时，</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">ats</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">会在不合格的主机名后面添加本地域名，如，请求的主机名是</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">host_x</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">，而本地域名是</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">y.com</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">，当开启该配置项时，</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">ats</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">把</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">host_x</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">扩展为</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">host_x.y.com</span></span></span></span></strong></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.dns.splitDNS.enabled</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">开启</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">SplitDNS</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">功能</span></span></strong></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.dns.url_expansions</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">主机名的扩展后缀，当</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">DNS</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">解析失败时，会把主机名加上给扩展后缀后重试，如配置为</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">org</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">，则</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">DNS</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">查找失败后</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">ats</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">会在主机名后面加上</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">.org</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">后再重试</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">DNS</span></span></span></span></strong><strong><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">查找</span></span></strong></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.dns.resolv_conf</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><strong><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></strong></span><strong><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">服务器的配置文件，这个文件的格式和</span></span></strong><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">resolv.conf</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">一样，</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ats</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">使用里面配置的</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">服务器。可以使用</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">/etc/resolv.config</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">或自己创建。</span></span></tt></p><dl><dt style="text-align: left;"><a name="proxy-config-dns-round-robin-nameservers"></a><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(255, 51, 102); font-size: 12px;"><span style="text-decoration: none;"></span></span></tt></span><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.dns.nameservers</span></span></span></tt></span></dt><dd style="text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">服务器的配置，除了可以在</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.dns.resolv_conf</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">指定的文件里配置外，</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">服务器也可以在这里也可以配置，如果两个都配置了，优先使用这里配置的，如果都没有配置，在使用系统默认的</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">/etc/resolv.conf</span></span></span></tt></span></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.dns.dedicated_thread</span></span></span></tt></span></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">是否要给</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">专门分配一个线程，默认为否</span></span></tt></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.dns.validate_query_name</span></span></span></tt></span></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">用于对付</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">伪造的，当发现</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">伪造时直接回弹</span></span></tt></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><strong>records.config</strong></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><strong>中</strong></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><strong>HostDB</strong></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><strong>相关配置说明</strong></span></tt></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.hostdb.serve_stale_for</span></span></span></tt></span></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">当正在给过期的</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">NS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">记录获取新的数据时，过期的</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">NS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">记录能使用的时间（单位是秒），默认是</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">0</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">，即如果</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">NS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">记录过期将不能再使用了</span></span></tt></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.hostdb.storage_size</span></span></span></tt></span></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">hostdb</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">的总大小（单位是字节）</span></span></tt></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.hostdb.size</span></span></span></tt></span></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">hostdb</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">中能存储的记录项的最大数，每条记录项至少为</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">44</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">字节，和</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">hostdb</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">的总大小息息相关</span></span></tt></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.hostdb.ttl_mode</span></span></span></tt></span></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">记录超时的计算方法，</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">0</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">：以</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">响应里的超时时间为依据，</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">1</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">：以配置的超时时间（</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.hostdb.timeout</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">）为依据，</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">2</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">：选择两者之间较小的为依据，</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">3</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">：选择两者之间较大的为依据</span></span></tt></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.hostdb.timeout</span></span></span></tt></span></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">自定义的</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">记录的超时时间</span></span></tt></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.hostdb.strict_round_robin</span></span></span></tt></span></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">一次</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNS</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">响应可能一个域名解析到多个</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ip</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">地址，默认相同</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">http</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">客户端会使用相同的源服务器，如果开启该配置项，则轮流使用解析到的多个</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ip</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">地址</span></span></tt></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.hostdb.ip_resolve</span></span></span></tt></span></dd><dd style="background: transparent none repeat scroll 0% 0%; text-align: left; margin-left: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">解析成</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ipv4</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">还是</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ipv6</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">，有四个值，可以配置多个，用分号隔开即可，顺序很重要，如果配置可个按顺序解析。</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">client</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">：根据客户端的地址族来解析，</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ipv4</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">：解析成</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ipv4</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">的地址，</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ipv6</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">：解析成</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ipv6</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">的地址，</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">none</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-size: 12px;"><span style="font-weight: normal;">：放弃解析</span></span></tt></dd></dl><p style="text-decoration: none; text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;"><strong>splitdns.config</strong></span><span style="font-family: monospace; font-size: 12px;"><strong>配置文件</strong></span></span></p><p style="font-weight: normal; text-decoration: none; text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;">配置该文件能实现的功能是，使得满足条件的</span><span style="font-family: monospace; font-size: 12px;">http</span><span style="font-family: monospace; font-size: 12px;">请求使用特定的</span><span style="font-family: monospace; font-size: 12px;">DNS</span><span style="font-family: monospace; font-size: 12px;">服务器来进行</span><span style="font-family: monospace; font-size: 12px;">DNS</span><span style="font-family: monospace; font-size: 12px;">查找，配置格式：</span></span></p><pre class="cjk" style="font-weight: normal; text-align: left; text-decoration: none;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">dest_domain=dest_domain | dest_host | url_regex named=dns_server def_domain=def_domain search_list=search_list</span><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;">dest_domain</span><span style="font-family: monospace; font-size: 12px;">：目的域名，可以使用！表示“非”</span></span><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;">dest_host</span><span style="font-family: monospace; font-size: 12px;">：目的主机，可以使用！表示“非”</span></span><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;">url_regex</span><span style="font-family: monospace; font-size: 12px;">：</span><span style="font-family: monospace; font-size: 12px;">url</span><span style="font-family: monospace; font-size: 12px;">的正则表达式</span></span><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;">named</span><span style="font-family: monospace; font-size: 12px;">：必选项，表示使用的</span><span style="font-family: monospace; font-size: 12px;">DNS</span><span style="font-family: monospace; font-size: 12px;">服务器，可以带端口，用冒号和</span><span style="font-family: monospace; font-size: 12px;">ip</span><span style="font-family: monospace; font-size: 12px;">地址隔开，没带端口默认使用</span><span style="font-family: monospace; font-size: 12px;">53</span></span><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="color: rgb(255, 51, 102);">def_domain</span></tt><tt class="western">:</tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk">可选项，默认的域名，</tt></span></span><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="color: rgb(255, 51, 102); font-family: monospace;">search_list</span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="font-family: monospace;">：可选项，用分号分割的域名列表</span></tt></span></span><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="font-family: monospace;"><strong>DNS</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="font-family: monospace;"><strong>初始化</strong></span></tt></span></span><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="font-family: monospace;"><strong>DNS</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="font-family: monospace;"><strong>相关的初始化包括</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="font-family: monospace;"><strong>hostdb</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="font-family: monospace;"><strong>、</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="font-family: monospace;"><strong>dns</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="font-family: monospace;"><strong>、</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="font-family: monospace;"><strong>splitdns</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="font-family: monospace;"><strong>的初始化</strong></span></tt></span></span><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="font-family: monospace;">main.cc</span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="font-family: monospace;">：</span></tt></span></span></pre><p style="font-weight: normal; text-decoration: none; text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"><tt class="cjk"></tt><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="font-family: monospace;">ink_hostdb_init(makeModuleVersion(HOSTDB_MODULE_MAJOR_VERSION,HOSTDB_MODULE_MINOR_VERSION , </span></tt><tt class="western"><span style="color: rgb(0, 0, 192); font-family: monospace;"><em>PRIVATE_MODULE_HEADER</em></span></tt><tt class="western"><span style="font-family: monospace;">));</span></tt></span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">ink_dns_init(makeModuleVersion(HOSTDB_MODULE_MAJOR_VERSION,HOSTDB_MODULE_MINOR_VERSION , </span><span style="color: rgb(0, 0, 192);"><em>PRIVATE_MODULE_HEADER</em></span><span style="color: rgb(0, 0, 0);">));</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">ink_split_dns_init(makeModuleVersion(1,0, </span><span style="color: rgb(0, 0, 192);"><em>PRIVATE_MODULE_HEADER</em></span><span style="color: rgb(0, 0, 0);">));</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px; color: rgb(0, 0, 0);">//</span><span style="font-family: monospace; font-size: 12px; color: rgb(0, 0, 0);">开启</span><span style="font-family: monospace; font-size: 12px; color: rgb(0, 0, 0);">splitDNS</span><span style="font-family: monospace; font-size: 12px; color: rgb(0, 0, 0);">的情况下进行读取</span><span style="font-family: monospace; font-size: 12px; color: rgb(0, 0, 0);">splitdns.config</span><span style="font-family: monospace; font-size: 12px; color: rgb(0, 0, 0);">的配置</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><strong>#ifdef</strong></span></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">SPLIT_DNS</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 80, 50);">SplitDNSConfig</span><span style="color: rgb(0, 0, 0);">::</span><span style="color: rgb(0, 0, 0);"><em>startup</em></span><span style="color: rgb(0, 0, 0);">();</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px; color: rgb(0, 0, 0);">hostdb</span><span style="font-family: monospace; font-size: 12px; color: rgb(0, 0, 0);">初始化：</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 0);">main()---&gt;</span><span style="color: rgb(0, 0, 0);"><strong>ink_hostdb_init()</strong></span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><strong>void</strong><span style="color: rgb(0, 0, 0);"><strong>ink_hostdb_init</strong></span><span style="color: rgb(0, 0, 0);">(ModuleVersionv)</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px; color: rgb(0, 0, 0);">{</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px;">......</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">ts_host_res_global_init();</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px; color: rgb(0, 0, 0);">}</span></p><pre class="cjk" style="font-weight: normal; text-align: left; text-decoration: none;"><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="font-family: monospace;"><strong>省略部分为</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="font-family: monospace;"><strong>hostdb</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="font-family: monospace;"><strong>各种状态信息计数的初始化，直接调用</strong></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="font-family: monospace;"><strong>ts_host_res_global_init()</strong></span></tt></span></span></pre><p style="font-weight: normal; text-decoration: none; text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><tt class="western"><span style="font-family: monospace;"><strong>main()---&gt;ink_hostdb_init()---&gt;ts_host_res_global_init()</strong></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace;"><span style="text-decoration: none;"><strong>v</strong></span></span></tt><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace;"><span style="text-decoration: none;"><span style="font-weight: normal;">oid</span></span></span></tt><span style="font-family: monospace;"><strong>ts_host_res_global_init</strong></span><span style="font-family: monospace;">()</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">{</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px; color: rgb(63, 127, 95);">//Global configuration values.</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(100, 40, 128);"><strong>memcpy</strong></span><span style="color: rgb(0, 0, 0);">(host_res_default_preference_order,</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">HOST_RES_DEFAULT_PREFERENCE_ORDER,</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>sizeof</strong></span><span style="color: rgb(0, 0, 0);">(host_res_default_preference_order));</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><br></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>char</strong></span><span style="color: rgb(0, 0, 0);">*ip_resolve = REC_ConfigReadString(</span><span style="color: rgb(42, 0, 255);">"proxy.config.hostdb.ip_resolve"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(ip_resolve) {</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">parse_host_res_preferences(ip_resolve,host_res_default_preference_order);</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">ats_free(ip_resolve);</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><pre class="cjk" style="font-weight: normal; text-align: left; text-decoration: none;"><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;">这个函数功能是读取配置项</span><span style="font-family: monospace; font-size: 12px; color: rgb(42, 0, 255);">proxy.config.hostdb.ip_resolve</span><span style="font-family: monospace; font-size: 12px; color: rgb(42, 0, 255);">（该配置项的意思参考前面的说明），然后调用函数</span><span style="font-family: monospace; font-size: 12px;">parse_host_res_preferences</span><span style="font-family: monospace; font-size: 12px; color: rgb(42, 0, 255);">进行解析，解析后把结果记录在全局的枚举数组 </span><span style="font-family: monospace; font-size: 12px;">host_res_default_preference_order</span><span style="font-family: monospace; font-size: 12px;">中</span></span></pre><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">main()---&gt;ink_hostdb_init()---&gt;ts_host_res_global_init()---&gt;</span></span></span></tt><tt class="western"><span style="color: rgb(26, 26, 26); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">parse_host_res_preferences</span></span></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">()</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><br></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><strong>void</strong></span></span></tt><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><strong>parse_host_res_preferences</strong></span><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">(</span><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><strong>char</strong></span><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"></span><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><strong>const</strong></span><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">*value, </span><span style="color: rgb(0, 80, 50); font-family: monospace; font-size: 12px;">HostResPreferenceOrder</span><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">order) {</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 80, 50);">Tokenizer</span><span style="color: rgb(0, 0, 0);">tokens(</span><span style="color: rgb(42, 0, 255);">";/|"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(63, 127, 95);">//preference from the </span><span style="color: rgb(63, 127, 95);"><span style="text-decoration: underline;">config</span></span><span style="color: rgb(63, 127, 95);">string.</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>int</strong></span><span style="color: rgb(0, 0, 0);">np = 0; </span><span style="color: rgb(63, 127, 95);">// index in to @am_host_res_preference</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>bool</strong></span><span style="color: rgb(0, 0, 0);">found[N_HOST_RES_PREFERENCE]; &nbsp;</span><span style="color: rgb(63, 127, 95);">//redundancy check array</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>int</strong></span><span style="color: rgb(0, 0, 0);">n; </span><span style="color: rgb(63, 127, 95);">// # of tokens</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>int</strong></span><span style="color: rgb(0, 0, 0);">i; </span><span style="color: rgb(63, 127, 95);">// index</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">n= tokens.Initialize(value);</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>for</strong></span><span style="color: rgb(0, 0, 0);">( i = 0 ; i &lt; N_HOST_RES_PREFERENCE ; ++i )</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">found[i] = </span><span style="color: rgb(127, 0, 85);"><strong>false</strong></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>for</strong></span><span style="color: rgb(0, 0, 0);">( i = 0 ; i &lt; n &amp;&amp; np &lt; N_HOST_RES_PREFERENCE_ORDER ;++i ) {</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>char</strong></span><span style="color: rgb(0, 0, 0);"></span><span style="color: rgb(127, 0, 85);"><strong>const</strong></span><span style="color: rgb(0, 0, 0);">*elt = tokens[i];</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px; color: rgb(63, 127, 95);">//special case none/only because that terminates the sequence.</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(0 == </span><span style="color: rgb(100, 40, 128);"><strong>strcasecmp</strong></span><span style="color: rgb(0, 0, 0);">(elt,HOST_RES_PREFERENCE_STRING[</span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_NONE</em></span><span style="color: rgb(0, 0, 0);">])){</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">found[</span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_NONE</em></span><span style="color: rgb(0, 0, 0);">]= </span><span style="color: rgb(127, 0, 85);"><strong>true</strong></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">order[np] = </span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_NONE</em></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>break</strong></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">}</span><span style="color: rgb(127, 0, 85);"><strong>else</strong></span><span style="color: rgb(0, 0, 0);">{</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px; color: rgb(63, 127, 95);">//scan the other types</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">HostResPreference ep =</span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_NONE</em></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>for</strong></span><span style="color: rgb(0, 0, 0);">( </span><span style="color: rgb(127, 0, 85);"><strong>int</strong></span><span style="color: rgb(0, 0, 0);">ip = </span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_NONE</em></span><span style="color: rgb(0, 0, 0);">+ 1 ; ip &lt; N_HOST_RES_PREFERENCE ; ++ip ) {</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px; color: rgb(255, 51, 102);">//</span><span style="font-family: monospace; font-size: 12px; color: rgb(255, 51, 102);">如果是</span><span style="font-family: monospace; font-size: 12px; color: rgb(255, 51, 102);">none</span><span style="font-family: monospace; font-size: 12px; color: rgb(255, 51, 102);">，则后面的就不用看了</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;"></span><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(0 == </span><span style="color: rgb(100, 40, 128);"><strong>strcasecmp</strong></span><span style="color: rgb(0, 0, 0);">(elt,HOST_RES_PREFERENCE_STRING[ip])) {</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">ep =</span><span style="color: rgb(127, 0, 85);"><strong>static_cast</strong></span><span style="color: rgb(0, 0, 0);">&lt;HostResPreference&gt;(ip);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>break</strong></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_NONE</em></span><span style="color: rgb(0, 0, 0);">!= ep &amp;&amp; !found[ep]) { </span><span style="color: rgb(63, 127, 95);">// ignoreduplicates</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">found[ep] = </span><span style="color: rgb(127, 0, 85);"><strong>true</strong></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">order[np++] = ep;</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(!found[</span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_NONE</em></span><span style="color: rgb(0, 0, 0);">]){</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px; color: rgb(63, 127, 95);">//If 'only' wasn't explicit, fill in the rest by default.</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(!found[</span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_IPV4</em></span><span style="color: rgb(0, 0, 0);">])</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">order[np++] =</span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_IPV4</em></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(!found[</span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_IPV6</em></span><span style="color: rgb(0, 0, 0);">])</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">order[np++] =</span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_IPV6</em></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(np &lt; N_HOST_RES_PREFERENCE)</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">order[np++] =</span><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_NONE</em></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; color: rgb(0, 0, 0); font-size: 12px;">} &nbsp; </span></p><p style="text-align: left; margin-bottom: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">这个函数的功能是把配置项</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(42, 0, 255); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.hostdb.ip_resolve</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(42, 0, 255); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">的值按</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(42, 0, 255); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">;/|</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(42, 0, 255); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">分割，分割后逐个判断，然后把全局枚举数组中的元素设置成响应的枚举值，枚举结构如下：</span></span></tt></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><strong>enum</strong></span></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">HostResPreference {</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_NONE</em></span><span style="color: rgb(0, 0, 0);">= 0, </span><span style="color: rgb(63, 127, 95);">///&lt; Invalid / </span><span style="color: rgb(63, 127, 95);"><span style="text-decoration: underline;">init</span></span><span style="color: rgb(63, 127, 95);">value.</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_CLIENT</em></span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(63, 127, 95);">///&lt; Prefer family of clientconnection.</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_IPV4</em></span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(63, 127, 95);">///&lt; Prefer IPv4.</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 192);"><em>HOST_RES_PREFER_IPV6</em></span><span style="color: rgb(0, 0, 0);"></span><span style="color: rgb(63, 127, 95);">///&lt; Prefer IPv6</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; color: rgb(0, 0, 0); font-size: 12px;">};</span></p><p style="text-align: left; margin-bottom: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">全局枚举数组的定义如下：</span></span></tt></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">HostResPreferencehost_res_default_preference_order[N_HOST_RES_PREFERENCE_ORDER];</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">其中</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">N_HOST_RES_PREFERENCE_ORDER</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">为</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">3</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="text-decoration: none;"><span style="font-weight: normal;">dns</span></span></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace;"><span style="font-weight: normal;">初始化：</span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">main()---&gt;</span></span></span></tt><tt class="western"><span style="color: rgb(26, 26, 26); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ink_dns_init</span></span></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">()</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><strong>void</strong></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><strong>ink_dns_init</strong>(ModuleVersionv)</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">{</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">......</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; color: rgb(0, 0, 0); font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">这里都是</span></span><span style="font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">dns</span></span></span><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">的</span></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">各种状态信息计数的初始化，这些留到</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">ats</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">启动流程分析再介绍</span></span></tt></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="text-decoration: none;"><span style="font-weight: normal;">dns</span></span></span></tt></span><span style="font-family: monospace; font-size: 12px;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace;"><span style="font-weight: normal;">初始化：</span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">main()---&gt;ink_split_dns_init()</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><strong>void</strong></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><strong>ink_split_dns_init</strong>(ModuleVersionv)</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">{</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>static</strong></span><span style="color: rgb(0, 0, 0);"></span><span style="color: rgb(127, 0, 85);"><strong>int</strong></span><span style="color: rgb(0, 0, 0);">init_called = 0;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">ink_release_assert(!checkModuleVersion(v,SPLITDNS_MODULE_VERSION));</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(init_called)</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>return</strong></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">init_called = 1;</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; color: rgb(0, 0, 0); font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">啥也没做，</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">init_called</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">置</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">1</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">表示已经初始化</span></span></tt></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">main()---&gt;SplitDNSConfig::startup()</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><strong>void</strong></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><strong>SplitDNSConfig::startup</strong>()</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">{</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 192);"><em>dnsHandler_mutex</em></span><span style="color: rgb(0, 0, 0);">= new_ProxyMutex();</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px; color: rgb(63, 127, 95);">//startupjust check gsplit_dns_enabled</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_ReadConfigInt32(</span><span style="color: rgb(0, 0, 192);"><em>gsplit_dns_enabled</em></span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.splitDNS.enabled"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">splitDNSUpdate = NEW(</span><span style="color: rgb(127, 0, 85);"><strong>new</strong></span><span style="color: rgb(0, 0, 0);"></span><span style="color: rgb(0, 80, 50);">ConfigUpdateHandler</span><span style="color: rgb(0, 0, 0);">&lt;</span><span style="color: rgb(0, 80, 50);">SplitDNSConfig</span><span style="color: rgb(0, 0, 0);">&gt;());</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">splitDNSUpdate-&gt;attach(</span><span style="color: rgb(42, 0, 255);">"proxy.config.cache.splitdns.filename"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; color: rgb(0, 0, 0); font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">创建并初始化互斥量</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 192); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">dnsHandler_mutex</span></span></em></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 192); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">读取配置项</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(42, 0, 255); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">proxy.config.dns.splitDNS.enabled</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(42, 0, 255); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">，即</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(42, 0, 255); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">splitDNS</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(42, 0, 255); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">的开关，赋值给</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 192); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">gsplit_dns_enabled</span></span></em></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 192); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">创建</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">splitDNSUpdate</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">，这里的核心就是调用</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">splitDNSUpdate-&gt;attach</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">注册回调函数</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 80, 50); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">ConfigUpdateHandler</span></span></em></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">::update</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">，一路跟踪这个函数最终调用的是</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 80, 50); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">SplitDNSConfig</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">的</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><strong>reconfigure</strong></span></em></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">()</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">函数，也就是这里并没有立马读取文件</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">splitdns.config</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">的内容，只是创建好</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">splitDNSUpdate</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">，等到下面</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">DNSProcessor::start()</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">的时候才回调</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 80, 50); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">SplitDNSConfig</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">的</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><strong>reconfigure</strong></span></em></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">()</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">来读取并解析</span></em></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><em><span style="text-decoration: none;"><span style="font-weight: normal;">splitdns.config</span></span></em></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><em><span style="font-weight: normal;">文件。</span></em></span></tt></p><p style="text-align: left; margin-bottom: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">下面该看</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">dns</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">和</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">hostdb</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">的启动了，还是在</span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">main.cc</span></span></span></tt></span><tt class="cjk"><span style="color: rgb(0, 0, 0); text-decoration: none; font-family: monospace; font-size: 12px;"><span style="font-weight: normal;">中：</span></span></tt></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;"></span></span></span></tt><tt class="western"><span style="color: rgb(26, 26, 26); font-family: monospace; font-size: 12px;"><span style="text-decoration: underline;"><span style="font-weight: normal;">dnsProcessor</span></span></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">.start(0,stacksize);</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><tt class="cjk"><span style="color: rgb(0, 0, 0);"><span style="text-decoration: none;"></span></span></tt><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><strong>if</strong></span></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">(hostDBProcessor.start() &lt; 0)</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 80, 50); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">main()---&gt;</span></span></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNSProcessor::start()</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><strong>int</strong></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 0);"><strong>DNSProcessor::start</strong></span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(127, 0, 85);"><strong>int</strong></span><span style="color: rgb(0, 0, 0);">,</span><span style="color: rgb(0, 80, 50);">size_t</span><span style="color: rgb(0, 0, 0);">stacksize) {</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">读取相应的配置项</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_EstablishStaticConfigInt32(dns_retries,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.retries"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_EstablishStaticConfigInt32(dns_timeout,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.lookup_timeout"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_EstablishStaticConfigInt32(dns_search,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.search_default_domains"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_EstablishStaticConfigInt32(dns_failover_number,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.failover_number"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_EstablishStaticConfigInt32(dns_failover_period,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.failover_period"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_EstablishStaticConfigInt32(dns_max_dns_in_flight,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.max_dns_in_flight"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_EstablishStaticConfigInt32(dns_validate_qname,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.validate_query_name"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_EstablishStaticConfigInt32(dns_ns_rr,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.round_robin_nameservers"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_ReadConfigStringAlloc(dns_ns_list,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.nameservers"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_ReadConfigStringAlloc(dns_local_ipv4,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.local_ipv4"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_ReadConfigStringAlloc(dns_local_ipv6,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.local_ipv6"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_ReadConfigStringAlloc(dns_resolv_conf,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.resolv_conf"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">REC_EstablishStaticConfigInt32(dns_thread,</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.dedicated_thread"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px; color: rgb(255, 51, 102);">//</span><span style="font-family: monospace; font-size: 12px; color: rgb(255, 51, 102);">如果需要另启一个线程来处理</span><span style="font-family: monospace; font-size: 12px; color: rgb(255, 51, 102);">DNS</span><span style="font-family: monospace; font-size: 12px; color: rgb(255, 51, 102);">则创建一个线程</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(dns_thread &gt; 0) {</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">ET_DNS =eventProcessor.spawn_event_threads(1, </span><span style="color: rgb(42, 0, 255);">"ET_DNS"</span><span style="color: rgb(0, 0, 0);">,stacksize);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">initialize_thread_for_net(eventProcessor.</span><span style="color: rgb(0, 0, 192);">eventthread</span><span style="color: rgb(0, 0, 0);">[ET_DNS][0]);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">}</span><span style="color: rgb(127, 0, 85);"><strong>else</strong></span><span style="color: rgb(0, 0, 0);">{</span><span style="color: rgb(255, 51, 102);">//</span></span><span style="font-family: monospace; font-size: 12px; color: rgb(255, 51, 102);">否则用线程池的即可</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">ET_DNS = ET_CALL;</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 192);">thread</span><span style="color: rgb(0, 0, 0);">= eventProcessor.</span><span style="color: rgb(0, 0, 192);">eventthread</span><span style="color: rgb(0, 0, 0);">[ET_DNS][0];</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 0);"></span><span style="color: rgb(255, 51, 102);">//dns</span></span><span style="font-family: monospace; font-size: 12px; color: rgb(255, 51, 102);">失败时重试的时间间隔</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">dns_failover_try_period =dns_timeout + 1;</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">如果开启</span><span style="font-family: monospace; font-size: 12px;">splitDNS</span><span style="font-family: monospace; font-size: 12px;">则读取并解析</span><span style="font-family: monospace; font-size: 12px;">splitdns.config</span><span style="font-family: monospace; font-size: 12px;">文件</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(0, 80, 50);">SplitDNSConfig</span><span style="color: rgb(0, 0, 0);">::</span><span style="color: rgb(0, 0, 192);"><em>gsplit_dns_enabled</em></span><span style="color: rgb(0, 0, 0);">){</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 80, 50);">SplitDNSConfig</span><span style="color: rgb(0, 0, 0);">::</span><span style="color: rgb(0, 0, 0);"><em>reconfigure</em></span><span style="color: rgb(0, 0, 0);">();</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">dns_init();</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">open();</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>return</strong></span><span style="color: rgb(0, 0, 0);">0;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; color: rgb(0, 0, 0); font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(0, 80, 50); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">main()---&gt;</span></span></span></tt><tt class="western"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><span style="font-weight: normal;">DNSProcessor::start()---&gt;SplitDNSConfig::reconfigure()</span></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: &quot;liberation serif&quot;,serif;"><tt class="western"><span style="color: rgb(127, 0, 85); font-family: monospace; font-size: 12px;"><span style="text-decoration: none;"><strong>void</strong></span></span></tt></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;"><strong>SplitDNSConfig::reconfigure</strong>()</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">{</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">如果没有开启</span><span style="font-family: monospace; font-size: 12px;">splitDNS</span><span style="font-family: monospace; font-size: 12px;">就没必要往下执行了</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(0 == </span><span style="color: rgb(0, 0, 192);"><em>gsplit_dns_enabled</em></span><span style="color: rgb(0, 0, 0);">)</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>return</strong></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">创建</span><span style="font-family: monospace; font-size: 12px;">splitDNS</span><span style="font-family: monospace; font-size: 12px;">实例</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 80, 50);">SplitDNS</span><span style="color: rgb(0, 0, 0);">*params = NEW(</span><span style="color: rgb(127, 0, 85);"><strong>new</strong></span><span style="color: rgb(0, 0, 0);"></span><span style="color: rgb(0, 80, 50);">SplitDNS</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">初始化</span><span style="font-family: monospace; font-size: 12px;">splitDNS</span><span style="font-family: monospace; font-size: 12px;">开关</span><span style="font-family: monospace; font-size: 12px;"><strong>m_SplitDNSlEnable</strong></span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">params-&gt;</span><span style="color: rgb(0, 0, 192);">m_SplitDNSlEnable</span><span style="color: rgb(0, 0, 0);">= </span><span style="color: rgb(0, 0, 192);"><em>gsplit_dns_enabled</em></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">根据</span><span style="font-family: monospace; font-size: 12px;">splitdns.config</span><span style="font-family: monospace; font-size: 12px;">文件创建</span><span style="font-family: monospace; font-size: 12px;">DNSserver</span><span style="font-family: monospace; font-size: 12px;">表</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">params-&gt;</span><span style="color: rgb(0, 0, 192);">m_DNSSrvrTable</span><span style="color: rgb(0, 0, 0);">= NEW(</span><span style="color: rgb(127, 0, 85);"><strong>new</strong></span><span style="color: rgb(0, 0, 0);"></span><span style="color: rgb(0, 80, 50);">DNS_table</span><span style="color: rgb(0, 0, 0);">(</span><span style="color: rgb(42, 0, 255);">"proxy.config.dns.splitdns.filename"</span><span style="color: rgb(0, 0, 0);">,modulePrefix, &amp;sdns_dest_tags));</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><br></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">获取</span><span style="font-family: monospace; font-size: 12px;">DNSserver</span><span style="font-family: monospace; font-size: 12px;">表的大小</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">params-&gt;</span><span style="color: rgb(0, 0, 192);">m_numEle</span><span style="color: rgb(0, 0, 0);">= params-&gt;</span><span style="color: rgb(0, 0, 192);">m_DNSSrvrTable</span><span style="color: rgb(0, 0, 0);">-&gt;getEntryCount();</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">如果</span><span style="font-family: monospace; font-size: 12px;">DNSserver</span><span style="font-family: monospace; font-size: 12px;">为空则设置</span><span style="font-family: monospace; font-size: 12px;">splitDNS</span><span style="font-family: monospace; font-size: 12px;">开关为关闭后退出</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(0 == params-&gt;</span><span style="color: rgb(0, 0, 192);">m_DNSSrvrTable</span><span style="color: rgb(0, 0, 0);">|| (0 == params-&gt;</span><span style="color: rgb(0, 0, 192);">m_numEle</span><span style="color: rgb(0, 0, 0);">)){</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">Warning(</span><span style="color: rgb(42, 0, 255);">"NoNAMEDs provided! Disabling SplitDNS"</span><span style="color: rgb(0, 0, 0);">);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 192);"><em>gsplit_dns_enabled</em></span><span style="color: rgb(0, 0, 0);">= 0;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>delete</strong></span><span style="color: rgb(0, 0, 0);">params;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>return</strong></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">？</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(0 != params-&gt;</span><span style="color: rgb(0, 0, 192);">m_DNSSrvrTable</span><span style="color: rgb(0, 0, 0);">-&gt;getHostMatcher()&amp;&amp;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">0 ==params-&gt;</span><span style="color: rgb(0, 0, 192);">m_DNSSrvrTable</span><span style="color: rgb(0, 0, 0);">-&gt;getReMatcher()&amp;&amp;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">0 ==params-&gt;</span><span style="color: rgb(0, 0, 192);">m_DNSSrvrTable</span><span style="color: rgb(0, 0, 0);">-&gt;getIPMatcher()&amp;&amp; 4 &gt;= params-&gt;</span><span style="color: rgb(0, 0, 192);">m_numEle</span><span style="color: rgb(0, 0, 0);">){</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><br></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 80, 50);">HostLookup</span><span style="color: rgb(0, 0, 0);">*pxHL = params-&gt;</span><span style="color: rgb(0, 0, 192);">m_DNSSrvrTable</span><span style="color: rgb(0, 0, 0);">-&gt;getHostMatcher()-&gt;getHLookup();</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">params-&gt;</span><span style="color: rgb(0, 0, 192);">m_pxLeafArray</span><span style="color: rgb(0, 0, 0);">= (</span><span style="color: rgb(127, 0, 85);"><strong>void</strong></span><span style="color: rgb(0, 0, 0);">*) pxHL-&gt;getLArray();</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace;"><span style="font-size: 12px;">params-&gt;</span><span style="color: rgb(0, 0, 192);">m_bEnableFastPath</span><span style="color: rgb(0, 0, 0);">= </span><span style="color: rgb(127, 0, 85);"><strong>true</strong></span><span style="color: rgb(0, 0, 0);">;</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">加到</span><span style="font-family: monospace; font-size: 12px;">ats</span><span style="font-family: monospace; font-size: 12px;">全局的配置信息结构</span><span style="font-family: monospace; font-size: 12px;">infos</span><span style="font-family: monospace; font-size: 12px;">中（留到</span><span style="font-family: monospace; font-size: 12px;">ats</span><span style="font-family: monospace; font-size: 12px;">启动流程来说）</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 0, 192);"><em>m_id</em></span><span style="color: rgb(0, 0, 0);">= configProcessor.set(</span><span style="color: rgb(0, 0, 192);"><em>m_id</em></span><span style="color: rgb(0, 0, 0);">,params);</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(255, 51, 102);"><span style="font-family: monospace; font-size: 12px;">//</span><span style="font-family: monospace; font-size: 12px;">如果</span><span style="font-family: monospace; font-size: 12px;">debug</span><span style="font-family: monospace; font-size: 12px;">开启，则打印</span><span style="font-family: monospace; font-size: 12px;">splitDNS</span><span style="font-family: monospace; font-size: 12px;">的配置信息</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(127, 0, 85);"><strong>if</strong></span><span style="color: rgb(0, 0, 0);">(is_debug_tag_set(</span><span style="color: rgb(42, 0, 255);">"splitdns_config"</span><span style="color: rgb(0, 0, 0);">)){</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0);"></span><span style="font-family: monospace; font-size: 12px;"><span style="color: rgb(0, 80, 50);">SplitDNSConfig</span><span style="color: rgb(0, 0, 0);">::</span><span style="color: rgb(0, 0, 0);"><em>print</em></span><span style="color: rgb(0, 0, 0);">();</span></span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="color: rgb(0, 0, 0); font-family: monospace; font-size: 12px;">}</span></p><p style="text-align: left; margin-bottom: 0cm;"><span style="font-family: monospace; color: rgb(0, 0, 0); font-size: 12px;">}</span></p><p>本文出自 “<a href="http://chenpiaoping.blog.51cto.com/">陈漂评的博客</a>” 博客，请务必保留此出处<a href="http://chenpiaoping.blog.51cto.com/5631143/1364486">http://chenpiaoping.blog.51cto.com/5631143/1364486</a></p>
		  </div>

			<!--正文 end-->



<div class="m_sharebtn clear">
	<table width="100%" cellspacing="0" cellpadding="0" border="0">
	  <tbody><tr>
		<td width="11%" valign="middle" align="center" height="43"><img src="ssk.png" alt="分享至"></td>
		<td width="77%" valign="top" align="left">
<!--
<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_bdhome" data-cmd="bdhome" title="分享到百度新首页"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a><a href="#" class="bds_bdysc" data-cmd="bdysc" title="分享到百度云收藏"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a></div>
<script>
var bds_config = {'wbUid':1706976420};
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false, 'bdPic':'http://blog.51cto.com/attachment/201305/173413310.jpg',"bdStyle":"1","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
 -->

<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_bdhome" data-cmd="bdhome" title="分享到百度新首页"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_bdysc" data-cmd="bdysc" title="分享到百度云收藏"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a></div>


	<!-- Baidu Button END --></td>
		<td width="12%" valign="middle" align="right"><a class="bdms_point" data-behavior="favorite" data-method="add" href="javascript:favorBox('open');" title="一键收藏，随时查看，分享好友！"><img src="favorite_add_small.gif" alt="一键收藏，随时查看，分享好友！" border="0"></a></td>
	  </tr>
	</tbody></table>

</div>
    		<div class="showBottom">
            <!--<div class="reviews"><span class="fl" style="cursor:pointer;"><a onclick="openFavoulist();" id="favourer"></a>

            </span><div id="favourdiv" class="support01">0人</div>
              <span class="fl">了这篇文章</span></div>-->
              <table width="720" cellspacing="0" cellpadding="0" border="0">
  <tbody><tr>
    <td align="right"><img src="icon01.png" width="15" height="16"> <span style="cursor: pointer;"><a onclick="openFavoulist();" id="favourer"></a></span></td>
    <td width="70" align="left"><div style="line-height: 28px;" id="favourdiv" class="support01">0人</div></td>
    <td width="60" align="left">了这篇文章</td>
  </tr>
</tbody></table>




            <div class="showType">类别：<a href="http://chenpiaoping.blog.51cto.com/5631143/d-8" class="operlink">traffic server</a>┆阅读(<span id="readNum">491</span>)┆评论(<span id="cmtNum">0</span>)

┆
<a href="http://chenpiaoping.blog.51cto.com/">返回博主首页</a>┆<a href="http://blog.51cto.com/">返回博客首页</a></div>
            <div class="prevNext">

			上一篇 <a href="http://chenpiaoping.blog.51cto.com/5631143/1346561" class="operlink" title="centos下载链接">centos下载链接</a>


			下一篇 <a href="http://chenpiaoping.blog.51cto.com/5631143/1364488" class="operlink" title="trafficserver的DNS初始化源码分析二">trafficserver的DNS初始化源码分析二</a>


            </div>

            </div>

	  </div><!--showBottom end-->
      </div><!--modCon-->
    <span class="modBot"></span>
    </div><!--artShow end-->
    <span class="blank"></span>




	<div class="relatedArt box">
		<a href="javascript:;"><img src="untitled"></a>
	</div>


<div class="artComm box">
    <div class="title"><a name="replay"></a><h2>文章评论</h2></div>
    <div class="modCon" id="artcomment">
		<div>  &nbsp;</div><div>  &nbsp;</div>
    </div><!--modCon-->
        <span class="modBot"></span>
</div><!--commBox end-->
<a href="http://chenpiaoping.blog.51cto.com/" id="com_top_top"></a>
<!--<div class="artComm box" style="750px;height:90px;">
<script type="text/javascript">
    var cpro_id = "u2386995";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
</div>--><form action="http://chenpiaoping.blog.51cto.com/comment.php?" method="post" name="form1" id="form1" onsubmit="return commentSubmit(this,&quot;&quot;);">
<span class="blank1"></span>
<div class="box writeComm" style="min-height: 30px;">
<a name="comment"></a>
<input name="action" value="comment" type="hidden">
<input id="commenttid" name="tid" value="1364486" type="hidden">
<input name="com_count_ajax" id="com_count_ajax" value="1" type="hidden">

 <div class="title">
	<h2 class="fl">发表评论&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>
	<span class="fl" id="messageTj">
<div id="beacon_8b89b65f72" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="lg.php" alt="" style="width: 0px; height: 0px;" width="0" height="0"></div>

</span>
	
</div>
<div style="display: none;" rel="" id="ggBox">
<div id="beacon_8b89b65f72" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="lg.php" alt="" style="width: 0px; height: 0px;" width="0" height="0"></div>

</div>

 <div class="modCon">

 <div class="commForm">
<dl>
<dt>昵&nbsp;&nbsp;称：</dt>
<dd>

<input id="commentusername" name="username" value="" class="commInput fl" type="text"><span><a href="http://home.51cto.com/index.php?reback=http%253A%252F%252Fchenpiaoping.blog.51cto.com%252F5631143%252F1364486" style="text-decoration: underline;">登录</a>&nbsp;&nbsp;<a href="http://home.51cto.com/user/register?reback=http%253A%252F%252Fchenpiaoping.blog.51cto.com%252F5631143%252F1364486" target="_top" style="text-decoration: underline;">快速注册</a></span>



</dd>
</dl>



<dl id="commentyanzheng">


<dt>验证码：</dt>
<dd><input class="code" value="" id="commentauthnum" name="authnum" onclick="displaysecunum();" type="text">

  <img class="fl" id="secunum" onclick="refimg()" style="display: none;" width="78" height="29"><p class="fl"><span style="display: none;" id="spanfont">点击图片可刷新验证码</span><span style="display: inline;" id="clickfont">请点击后输入验证码</span><span class="pl5"><a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_top" style="text-decoration: underline;">博客过2级，无需填写验证码</a></span></p></dd>
</dl>
<dl>
<dt>内&nbsp;&nbsp;容：</dt>
<dd>
<textarea class="writeCommCon f12" id="commentcontent" name="content"></textarea>
</dd>
</dl>
</div>
<div class="writeCommBot">
  <input name="parentid" value="" id="parentid" type="hidden">
  <input class="commBtn fl" name="submit" id="commentsubmit" value="" onclick="commentSubmitend2()" type="button">

 <p class="fl" style="display: none;"><input class="fl" name="favour" id="favour" checked="checked" value="1" type="checkbox"><span class="fl">同时赞一个</span></p>

</div>
<span class="blank"></span>

</div><!--modCon-->
<span class="modBot"></span>
</div>
</form>
<iframe id="iframe1" name="iframe1" src="index_1.html" width="0" height="0"></iframe>
<!--发表评论 end-->
</div>
</div>
<!-- <div style="width:100px; height:300px; position:fixed; top:25%;left:50%;margin-left:-613px;z-index:100; _position:absolute; _margin-top: 0; _top:expression(documentElement.scrollTop+(documentElement.clientHeight-this.offsetHeight)/2+50);" id="f_close_box">
<img border="0" usemap="#Map1" src="https://s1.51cto.com/wyfs02/M00/93/21/wKiom1kISujgrYSbAADPIiyteUc221.jpg">
<map id="Map1" name="Map1">
<area onclick="document.getElementById('f_close_box').style.display='none';" href="javascript:void(0);" coords="86,14,10"  shape="circle">
</map>

</div> -->
<iframe src="index_2.html" style="position: fixed; left: 0px; top: 240px; width: 100px; height: 300px;" scrolling="no" frameborder="0"></iframe>

<div id="SL_balloon_obj" style="display: none;"><div id="SL_button" style="background: rgba(0, 0, 0, 0) url('undefined') repeat scroll 0% 0%; display: block; width: 24px; height: 24px; position: absolute; cursor: pointer;"></div><div id="SL_shadow_translation_result2" style="display: none;"></div><div id="SL_shadow_translator"><div id="SL_providers"><div class="SL_BL_LABLE_ON" title="Google" id="SL_P0">G</div><div class="SL_BL_LABLE_ON" title="Microsoft" id="SL_P1">M</div><div class="SL_BL_LABLE_ON" title="Translator" id="SL_P2">T</div></div><div id="SL_planshet" style="background: rgb(244, 245, 245) url('undefined') repeat scroll 0% 0%;"><div id="SL_arrow_up"></div><div id="SL_TB"><div id="bubblelogo" style="background: rgba(0, 0, 0, 0) url('undefined') repeat scroll 0% 0%; display: block; width: 24px; height: 24px; position: absolute;"></div><table id="SL_tables"><tr><td width="10%" align="right"><input id="SLloc" title="鎖定語言" type="checkbox"></td><td width="20%" align="left"><select id="SL_lng_from"><option value="auto">檢測語言</option><option value="sq">阿尔巴尼亚语</option><option value="ar">阿拉伯语</option><option value="az">阿塞拜疆语</option><option value="ga">爱尔兰语</option><option value="et">爱沙尼亚语</option><option value="eu">巴斯克语</option><option value="be">白俄罗斯语</option><option value="bg">保加利亚语</option><option value="is">冰岛语</option><option value="pl">波兰语</option><option value="bs">波斯尼亚语</option><option value="fa">波斯语</option><option value="af">布尔语(南非荷兰语)</option><option value="da">丹麦语</option><option value="de">德语</option><option value="ru">俄语</option><option value="fr">法语</option><option value="tl">菲律宾语</option><option value="fi">芬兰语</option><option value="km">高棉语</option><option value="ka">格鲁吉亚语</option><option value="gu">古吉拉特语</option><option value="kk">哈萨克语</option><option value="ht">海地克里奥尔语</option><option value="ko">韩语</option><option value="ha">豪萨语</option><option value="nl">荷兰语</option><option value="gl">加利西亚语</option><option value="ca">加泰罗尼亚语</option><option value="cs">捷克语</option><option value="kn">卡纳达语</option><option value="hr">克罗地亚语</option><option value="la">拉丁语</option><option value="lv">拉脱维亚语</option><option value="lo">老挝语</option><option value="lt">立陶宛语</option><option value="ro">罗马尼亚语</option><option value="mg">马尔加什语</option><option value="mt">马耳他语</option><option value="mr">马拉地语</option><option value="ml">马拉雅拉姆语</option><option value="ms">马来语</option><option value="mk">马其顿语</option><option value="mi">毛利语</option><option value="mn">蒙古语</option><option value="bn">孟加拉语</option><option value="my">缅甸语</option><option value="hmn">苗语</option><option value="zu">南非祖鲁语</option><option value="ne">尼泊尔语</option><option value="no">挪威语</option><option value="pa">旁遮普语</option><option value="pt">葡萄牙语</option><option value="ny">齐切瓦语</option><option value="ja">日语</option><option value="sv">瑞典语</option><option value="sr">塞尔维亚语</option><option value="st">塞索托语</option><option value="si">僧伽罗语</option><option value="eo">世界语</option><option value="sk">斯洛伐克语</option><option value="sl">斯洛文尼亚语</option><option value="sw">斯瓦希里语</option><option value="ceb">宿务语</option><option value="so">索马里语</option><option value="tg">塔吉克语</option><option value="te">泰卢固语</option><option value="ta">泰米尔语</option><option value="th">泰语</option><option value="tr">土耳其语</option><option value="cy">威尔士语</option><option value="ur">乌尔都语</option><option value="uk">乌克兰语</option><option value="uz">乌兹别克语</option><option value="iw">希伯来语</option><option value="el">希腊语</option><option value="es">西班牙语</option><option value="hu">匈牙利语</option><option value="hy">亚美尼亚语</option><option value="ig">伊博语</option><option value="it">意大利语</option><option value="yi">意第绪语</option><option value="hi">印地语</option><option value="su">印尼巽他语</option><option value="id">印尼语</option><option value="jw">印尼爪哇语</option><option value="en">英语</option><option value="yo">约鲁巴语</option><option value="vi">越南语</option><option value="zh-CN">中文简体</option><option value="zh-TW">中文繁体</option></select></td><td width="5%" align="center"><div id="SL_switch_b" title="切換語言" style="background: rgba(0, 0, 0, 0) url('undefined') repeat scroll 0% 0%; display: block; width: 10px; height: 10px; cursor: pointer;" align="center"></div></td><td width="20%" align="left"><select id="SL_lng_to"><option value="sq">阿尔巴尼亚语</option><option value="ar">阿拉伯语</option><option value="az">阿塞拜疆语</option><option value="ga">爱尔兰语</option><option value="et">爱沙尼亚语</option><option value="eu">巴斯克语</option><option value="be">白俄罗斯语</option><option value="bg">保加利亚语</option><option value="is">冰岛语</option><option value="pl">波兰语</option><option value="bs">波斯尼亚语</option><option value="fa">波斯语</option><option value="af">布尔语(南非荷兰语)</option><option value="da">丹麦语</option><option value="de">德语</option><option value="ru">俄语</option><option value="fr">法语</option><option value="tl">菲律宾语</option><option value="fi">芬兰语</option><option value="km">高棉语</option><option value="ka">格鲁吉亚语</option><option value="gu">古吉拉特语</option><option value="kk">哈萨克语</option><option value="ht">海地克里奥尔语</option><option value="ko">韩语</option><option value="ha">豪萨语</option><option value="nl">荷兰语</option><option value="gl">加利西亚语</option><option value="ca">加泰罗尼亚语</option><option value="cs">捷克语</option><option value="kn">卡纳达语</option><option value="hr">克罗地亚语</option><option value="la">拉丁语</option><option value="lv">拉脱维亚语</option><option value="lo">老挝语</option><option value="lt">立陶宛语</option><option value="ro">罗马尼亚语</option><option value="mg">马尔加什语</option><option value="mt">马耳他语</option><option value="mr">马拉地语</option><option value="ml">马拉雅拉姆语</option><option value="ms">马来语</option><option value="mk">马其顿语</option><option value="mi">毛利语</option><option value="mn">蒙古语</option><option value="bn">孟加拉语</option><option value="my">缅甸语</option><option value="hmn">苗语</option><option value="zu">南非祖鲁语</option><option value="ne">尼泊尔语</option><option value="no">挪威语</option><option value="pa">旁遮普语</option><option value="pt">葡萄牙语</option><option value="ny">齐切瓦语</option><option value="ja">日语</option><option value="sv">瑞典语</option><option value="sr">塞尔维亚语</option><option value="st">塞索托语</option><option value="si">僧伽罗语</option><option value="eo">世界语</option><option value="sk">斯洛伐克语</option><option value="sl">斯洛文尼亚语</option><option value="sw">斯瓦希里语</option><option value="ceb">宿务语</option><option value="so">索马里语</option><option value="tg">塔吉克语</option><option value="te">泰卢固语</option><option value="ta">泰米尔语</option><option value="th">泰语</option><option value="tr">土耳其语</option><option value="cy">威尔士语</option><option value="ur">乌尔都语</option><option value="uk">乌克兰语</option><option value="uz">乌兹别克语</option><option value="iw">希伯来语</option><option value="el">希腊语</option><option value="es">西班牙语</option><option value="hu">匈牙利语</option><option value="hy">亚美尼亚语</option><option value="ig">伊博语</option><option value="it">意大利语</option><option value="yi">意第绪语</option><option value="hi">印地语</option><option value="su">印尼巽他语</option><option value="id">印尼语</option><option value="jw">印尼爪哇语</option><option value="en">英语</option><option value="yo">约鲁巴语</option><option value="vi">越南语</option><option value="zh-CN">中文简体</option><option value="zh-TW">中文繁体</option></select></td><td width="5%" align="center"> </td><td width="6%" align="center"><div id="SL_TTS_voice" title="聆聽" style="background: rgba(0, 0, 0, 0) url('undefined') repeat scroll 0% 0%;"></div></td><td width="6%" align="center"><div id="SL_copy" title="複製譯文" style="background: rgba(0, 0, 0, 0) url('undefined') repeat scroll 0% 0%;"></div></td><td width="6%" align="center"><div id="SL_bbl_font_patch" title="此功能在字典中禁用"></div><div id="SL_bbl_font" title="字體大小" style="background: rgba(0, 0, 0, 0) url('undefined') repeat scroll 0% 0%;"></div></td><td width="6%" align="center"><div id="SL_TH" title="翻譯歷史" style="background: rgba(0, 0, 0, 0) url('undefined') repeat scroll 0% 0%;"></div></td><td width="10%"></td><td width="6%" align="right"><div id="SL_pin" title="固定彈出窗口" style="background: rgba(0, 0, 0, 0) url('undefined') repeat scroll 0% 0%; display: block; width: 16px; height: 16px; cursor: pointer;"></div></td></tr></table></div><div id="SL_alert_bbl"><div id="SLHKclose"></div><div id="SL_alert_cont"></div></div></div><div id="SL_shadow_translation_result" style="background: rgb(255, 255, 255) url('undefined') repeat scroll 0% 0%;"></div><div id="SL_loading" style="background: rgba(0, 0, 0, 0) url('undefined') repeat scroll 0% 0%; display: block; position: absolute; width: 35px; margin-left: 180px; margin-top: -40px; height: 35px;"></div><div id="SL_player2"></div><div id="SL_alert100">語言功能限200個字符</div><div id="SL_Balloon_options" style="background: rgb(255, 255, 255) none repeat scroll 0% 0%;"><div id="SL_arrow_down"></div><table width="100%"><tr><td width="18%" align="left" height="16"><div id="SL_bbl_donate" title="進行一點捐款" style="background: rgba(0, 0, 0, 0) url('undefined') repeat scroll 0% 0%;"></div></td><td width="68%" align="center"><a href="#" id="OPlnk" title="顯示選項">選項</a> : <a href="#" id="HISTlnk" title="翻譯歷史">歷史</a> : <a href="http://about.imtranslator.net/tutorials/presentations/imtranslator-translator-for-firefox/popup-bubble-application/" target="_top" id="HELPlnk" title="幫助">幫助</a> : <a href="#" id="FBlnk" title="反饋">反饋</a></td><td width="15%" align="right"><a id="SL_Balloon_Close" href="#" title="關閉">關閉</a></td></tr></table></div></div></div>



<!-- <script src="http://blog.51cto.com/js/blog_top_list.php" type="text/javascript" language="javascript"></script> -->

<!--<div id="message" class="blogpop" style="background-color:#FFFFFF;z-index:100;width:389px;height:196px;position:absolute; display:none; bottom:0; top:'document.documentElement.scrollTop + document.documentElement.clientHeight-196+'px;right:0; overflow:hidden;"><iframe style="width:800px;height:536px;top:0px;left:0px;position:absolute;visibility:inherit;z-index:-1;" frameborder=0 ></iframe>-->
<!--<div style="height:36px;background:url(http://blog.51cto.com/image/blog_top/popbgx.jpg) repeat-x; position:relative;width:387px;border-right-color:#2668B7;border-right-width:2px;border-right-style:solid 2px #2668B7;"><span style="right:10px;padding:12px 0 0;position:absolute;top:0"><span style="margin-right:80px;color:#828282;width:190px;padding:10px 0 0 10px;font-size:14px">每日博报 精彩不止一点</span><img title="关闭" id="message_close" src="http://blog.51cto.com/image/blog_top/close.jpg" alt="关闭" /></span><div style="width:387px;height:36px;left:0;overflow:hidden; text-indent:-999em;background:url(http://blog.51cto.com/image/blog_top/hdtit.jpg) no-repeat;border-right:solid 2px #2668B7;"><a style="display: block; height: 36px;width:138px;" target="_blank" href="http://blog.51cto.com"></a>-->
<!--</div>-->
<!--<div style="clear:both;"></div>-->
<!--</div>-->
	<!--<div id="message_content" style="border-top:none;font-family:Microsoft YaHei;font-size:12px;width:389px;height:160pxpx;text-align:left;overflow:hidden;">-->
	<!--<script type='text/javascript'>&lt;!&ndash;//<![CDATA[-->
	   <!--var m3_u = (location.protocol=='https:'?'https://gg.51cto.com/www/delivery/ajs.php':'http://gg3.51cto.com/www/delivery/ajs.php');-->
	   <!--var m3_r = Math.floor(Math.random()*99999999999);-->
	   <!--if (!document.MAX_used) document.MAX_used = ',';-->
	   <!--document.write ("<scr"+"ipt type='text/javascript' src='"+m3_u);-->
	   <!--document.write ("?zoneid=454");-->
	   <!--document.write ('&amp;cb=' + m3_r);-->
	   <!--if (document.MAX_used != ',') document.write ("&amp;exclude=" + document.MAX_used);-->
	   <!--document.write (document.charset ? '&amp;charset='+document.charset : (document.characterSet ? '&amp;charset='+document.characterSet : ''));-->
	   <!--document.write ("&amp;loc=" + escape(window.location));-->
	   <!--if (document.referrer) document.write ("&amp;referer=" + escape(document.referrer));-->
	   <!--if (document.context) document.write ("&context=" + escape(document.context));-->
	   <!--if (document.mmm_fo) document.write ("&amp;mmm_fo=1");-->
	   <!--document.write ("'><\/scr"+"ipt>");-->
	<!--//]]>&ndash;&gt;</script>-->
	<!--</div>-->
<!--</div>-->


<div class="backToTop tops" title="返回顶部" style="display: block;">返回顶部</div>








<div class="clear"></div>
<!-- <script>
jQuery(function(){
	var html= "<div id=\"sogou_se_tgbar\" style=\"text-align:center;margin:0px auto 2px auto;clear:both;background:url(http://home.51cto.com/public/images/notice/sogou_se_tgbar_bg_final1.gif) repeat-x;width:950px;color:#000;font-size:13px;height:36px;z-index:21474836471\"><div style=\"float:left;cursor:pointer;width:910px;text-align:center;border-left:solid #efbf00 1px;height:32px; line-height:32px;txt-align:center;\"><span style=\"\">	<a href=\"http://51ctoblog.blog.51cto.com/26414/1093282\">【新年祝福征集】51CTO社区年底嘉年华活动正在征集博主祝福语，祝福以红包的形式随机的赠送给访问51CTO的网友 点此送祝福>></a></span></div><div onclick=\"document.getElementById('sogou_se_tgbar').style.display = 'none';\" style=\"float:right;width:20px;cursor:pointer;height:28px;padding:4px 8px 0px 8px;border-right:solid #efbf00 1px\"><img style=\"border:none;margin:4px 0px 0px 0px;\" src=\"http://home.51cto.com/public/images/notice/sogou_se_tgbar_close_final1.gif\"></div></div>"
	jQuery('body').prepend(html);
})
</script> -->


<div class="fixexit_small">
    <div class="infixexit" style="font-family: &quot;微软雅黑&quot;;">
        <div class="exit_list exit_list_zxun"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1173854158&amp;site=qq&amp;menu=yes" class="ina" target="_top"></a></div>
        <div class="exit_list exit_list_fkui "><span class="ina"><a href="http://51ctoblog.blog.51cto.com/26414/1933645"><b>意见<br>反馈</b></a></span></div>
        <div class="exit_list  exit_list_gaozhao"><a href="http://51ctoblog.blog.51cto.com/" target="_black" class="ina"></a></div>

    </div>
</div>
<div id="footer">
  <div id="innerFooter">
	<center>
		<small>
			Copyright By 51CTO.COM 版权所有<br><br>
			<a href="http://blog.51cto.com/" target="_top"><img src="copyright.jpg"></a>
	  </small>
	</center>
  </div>
</div>

<div style="display: none;">

<div style="display: none;">

    

    


</div>
<iframe scrolling="no" src="index_3.html" width="0" height="0" frameborder="0"></iframe>
</div>





</body>
</html>
